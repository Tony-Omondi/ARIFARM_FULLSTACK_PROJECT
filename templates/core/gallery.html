{# templates/products/gallery.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Gallery - AriFarm Organic Shop{% endblock %}

{% block content %}

<div class="breadcrumbs-area position-relative">
    <div class="container">
        <div class="row">
            <div class="col-12 text-center">
                <div class="breadcrumb-content position-relative section-content">
                    <h3 class="title-3">Our Gallery</h3>
                    <ul>
                        <li><a href="{% url 'home' %}">Home</a></li>
                        <li>Gallery</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="product-area mt-no-text mb-no-text">
    <div class="container container-default-2 custom-area">
        
        <div class="row">
            <div class="col-lg-5 m-auto text-center col-custom">
                <div class="section-content">
                    <h2 class="title-1 text-uppercase">Life at AriFarm</h2>
                    <div class="desc-content">
                        <p>Fresh harvests, farm activities, and real moments â€“ captured and shared.</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12 text-center mb-5">
                <div class="gallery-filter-nav">
                    <button class="btn obrien-button-2 active mr-2 mb-2" data-filter="*">All</button>
                    {% for category in categories %}
                    <button class="btn obrien-button-2 mr-2 mb-2" data-filter=".cat-{{ category.slug }}">{{ category.name }}</button>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="row gallery-grid">
            {% for item in gallery_items %}
            <div class="col-lg-4 col-md-6 col-sm-12 col-custom gallery-item cat-{{ item.category.slug }} mb-4">
                <div class="gallery-card single-product position-relative">
                    
                    <div class="product-image box-img position-relative" style="cursor: pointer;">
                        
                        {% if item.get_thumbnail_url %}
                            <img src="{{ item.get_thumbnail_url }}" 
                                 alt="{{ item.title }}" 
                                 class="w-100" 
                                 style="height: 300px; object-fit: cover; border-radius: 5px;"
                                 onerror="this.style.display='none'; document.getElementById('fallback-{{ item.id }}').style.display='flex';">
                            
                            <div id="fallback-{{ item.id }}" class="social-placeholder {{ item.media_type }}" style="display: none; height: 300px;">
                                <span>
                                    {% if item.media_type == 'tiktok' %} <i class="fab fa-tiktok fa-3x"></i>
                                    {% elif item.media_type == 'instagram' %} <i class="fab fa-instagram fa-3x"></i>
                                    {% else %} <i class="fas fa-play fa-3x"></i> {% endif %}
                                </span>
                            </div>
                        {% else %}
                            <div class="social-placeholder {{ item.media_type }}" style="height: 300px;">
                                <span>
                                    {% if item.media_type == 'tiktok' %} <i class="fab fa-tiktok fa-3x"></i>
                                    {% elif item.media_type == 'instagram' %} <i class="fab fa-instagram fa-3x"></i>
                                    {% else %} <i class="fas fa-image fa-3x"></i> {% endif %}
                                </span>
                            </div>
                        {% endif %}

                        <div class="content-type-badge {{ item.media_type }}">
                            {% if item.media_type == 'image' %} <i class="fas fa-camera"></i> Photo
                            {% elif item.media_type == 'youtube' %} <i class="fab fa-youtube"></i> YouTube
                            {% elif item.media_type == 'instagram' %} <i class="fab fa-instagram"></i> Instagram
                            {% elif item.media_type == 'tiktok' %} <i class="fab fa-tiktok"></i> TikTok
                            {% endif %}
                        </div>

                        <div class="add-action d-flex position-absolute" style="background: rgba(0,0,0,0.3); width: 100%; height: 100%; top: 0; left: 0; justify-content: center; align-items: center; opacity: 0; transition: 0.3s;">
                            <a href="#" style="color: white; font-size: 3rem;">
                                <i class="ion-ios-plus-empty"></i>
                            </a>
                        </div>
                    </div>

                    <div class="product-content mt-3">
                        <div class="product-title">
                            <h4 class="title-2">{{ item.title }}</h4>
                        </div>
                        {% if item.description %}
                            <p class="desc-content mb-2 text-muted small text-truncate">{{ item.description }}</p>
                        {% endif %}
                        <div class="product-rating">
                            <span class="badge badge-light border">{{ item.category.name }}</span>
                        </div>
                    </div>

                </div>

                <div class="modal fade" id="modal-{{ item.id }}" tabindex="-1" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-xl">
                        <div class="modal-content">
                            <div class="modal-header border-0 pb-0">
                                <h5 class="modal-title ps-2">{{ item.title }}</h5>
                                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body p-3 text-center">
                                
                                {% if item.media_type == 'image' and item.image %}
                                    <img src="{{ item.image.url }}" class="img-fluid rounded" alt="{{ item.title }}">

                                {% elif item.media_type == 'youtube' and item.get_youtube_embed_url %}
                                    <div class="ratio ratio-16x9 mx-auto" style="max-width: 900px;">
                                        <iframe src="{{ item.get_youtube_embed_url }}" title="YouTube video" frameborder="0" allowfullscreen></iframe>
                                    </div>

                                {% elif item.media_type == 'instagram' and item.get_instagram_embed_url %}
                                    <div class="d-flex justify-content-center">
                                        <iframe src="{{ item.get_instagram_embed_url }}" 
                                                class="instagram-frame border-0" 
                                                frameborder="0" 
                                                scrolling="yes" 
                                                allowtransparency="true"
                                                style="width: 100%; max-width: 540px; min-width: 320px; min-height: 750px; height: 100%;"></iframe>
                                    </div>

                                {% elif item.media_type == 'tiktok' and item.get_tiktok_embed_code %}
                                    <div class="tiktok-container d-flex justify-content-center">
                                        {{ item.get_tiktok_embed_code|safe }}
                                    </div>
                                {% endif %}

                            </div>
                            {% if item.description %}
                            <div class="modal-footer justify-content-start border-0 pt-0">
                                <p class="text-muted">{{ item.description }}</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="far fa-images fa-4x text-muted mb-4"></i>
                <h3>No items in gallery yet</h3>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<style>
    :root {
        --primary-green: #77DD77;
        --sun-yellow: #FFDF22;
        --sun-yellow-dark: #E8C000;
    }

    /* Badges */
    .content-type-badge { 
        position:absolute; top:15px; right:15px; padding:6px 14px; border-radius:30px; font-size:12px; font-weight:600; color:white; z-index:2; box-shadow: 0 2px 5px rgba(0,0,0,0.2); 
    }
    .content-type-badge.image { background: var(--primary-green); }
    .content-type-badge.youtube { background:#FF0000; }
    .content-type-badge.instagram { background: linear-gradient(45deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); }
    .content-type-badge.tiktok { background:#000000; }

    /* Category badge under title */
    .product-rating .badge {
        background: var(--primary-green);
        color: white;
        border: none;
    }

    /* Social Placeholders */
    .social-placeholder { 
        width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: bold; border-radius: 5px; background-color: #eee; 
    }
    .social-placeholder.tiktok { background-color: #000; }
    .social-placeholder.instagram { background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%); }
    .social-placeholder.youtube { background-color: #000; }
    .social-placeholder.image { background-color: #f0f0f0; color: #999; }

    /* Filter Buttons */
    .gallery-filter-nav .btn {
        background: white;
        border: 2px solid #ddd;
        color: #555;
    }
    .gallery-filter-nav .btn:hover {
        border-color: var(--primary-green);
        color: var(--primary-green);
    }
    .gallery-filter-nav .btn.active {
        background-color: var(--primary-green) !important;
        color: #fff !important;
        border-color: var(--primary-green) !important;
    }

    /* Hover Effects */
    .box-img:hover .add-action { opacity: 1 !important; }
    .add-action a { color: white; }

    .gallery-card:hover {
        box-shadow: 0 10px 25px rgba(119, 221, 119, 0.25) !important;
    }

    /* TikTok embeds centered */
    .tiktok-container {
        max-width: 540px;
        margin: 0 auto;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // Filter Logic
    const buttons = document.querySelectorAll('.gallery-filter-nav button');
    const items = document.querySelectorAll('.gallery-item');

    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            buttons.forEach(b => b.classList.remove('active'));
            btn.classList.add('active');

            const filter = btn.getAttribute('data-filter');
            
            items.forEach(item => {
                if (filter === '*' || item.classList.contains(filter.substring(1))) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });

    // Modal Trigger
    document.querySelectorAll('.gallery-card .box-img').forEach(trigger => {
        trigger.addEventListener('click', function() {
            const cardItem = this.closest('.gallery-item');
            const modalEl = cardItem.querySelector('.modal');
            
            modalEl.addEventListener('hidden.bs.modal', function () {
                const iframe = modalEl.querySelector('iframe');
                if (iframe) {
                    const iframeSrc = iframe.src;
                    iframe.src = iframeSrc; 
                }
            });

            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        });
    });
});
</script>
{% endblock %}