{% load static %}

<aside class="off-canvas-wrapper" id="mobileMenu">
    <div class="off-canvas-overlay" onclick="toggleMenu()"></div>

    <div class="off-canvas-inner-content">
        <!-- Header with Logo + User Status -->
        <div class="off-canvas-header d-flex align-items-center justify-content-between p-3 border-bottom">
            <div class="logo-area">
                <a href="{% url 'home' %}">
                    <img src="{% static 'assets/images/logo/logo.png' %}" alt="AriFarm Logo" style="max-height: 40px;">
                </a>
            </div>

            <!-- User Status / Avatar + Profile Icon -->
            <div class="mobile-user-status d-flex align-items-center gap-3">
                {% if user.is_authenticated %}
                    <!-- Small avatar/initials or icon -->
                    <div class="user-avatar">
                        {% if user.profile.avatar %}
                            <img src="{{ user.profile.avatar.url }}" alt="Profile" class="rounded-circle" style="width:36px; height:36px; object-fit:cover; border:2px solid #eee;">
                        {% else %}
                            <!-- Simple icon instead of placeholder div with text -->
                            {% comment %} <div class="avatar-icon rounded-circle d-flex align-items-center justify-content-center" 
                                 style="width:36px; height:36px; background:#E98C81; color:white;">
                                <i class="fa fa-user" style="font-size:1.1rem;"></i>
                            </div> {% endcomment %}
                        {% endif %}
                    </div>

                    <!-- Larger clickable profile icon -->
                    <a href="{% url 'profile' %}" class="profile-icon-link" title="My Account">
                        <i class="fa fa-user-circle fa-2x" style="color: #4a4a4a;"></i>
                    </a>
                {% else %}
                    <!-- Guest state -->
                    <div class="user-avatar">
                        <div class="avatar-icon rounded-circle d-flex align-items-center justify-content-center" 
                             style="width:38px; height:38px; background:#e0e0e0; color:#666;">
                            <i class="fa fa-user" style="font-size:1.3rem;"></i>
                        </div>
                    </div>

                    <!-- Clickable login icon -->
                    <a href="{% url 'login' %}" class="profile-icon-link" title="Login">
                        <i class="fa fa-sign-in fa-2x" style="color: #666;"></i>
                    </a>
                {% endif %}
            </div>

            <div class="btn-close-off-canvas" onclick="toggleMenu()">
                <i class="fa fa-times"></i>
            </div>
        </div>

        <!-- Scrollable Content -->
        <div class="off-canvas-scrollable">
            <div class="mobile-navigation">
                <nav>
                    <ul class="mobile-menu list-unstyled">
                        {% with request.resolver_match.url_name as url_name %}
                        <li class="{% if url_name == 'home' %}active-menu{% endif %}">
                            <a href="{% url 'home' %}">Home</a>
                        </li>
                        <li class="{% if url_name == 'product_list' or url_name == 'product_detail' %}active-menu{% endif %}">
                            <a href="{% url 'products:product_list' %}">Shop All Products</a>
                        </li>
                        <li class="{% if url_name == 'basket_list' %}active-menu{% endif %}">
                            <a href="{% url 'products:basket_list' %}">Combo Offers</a>
                        </li>
                        <li class="{% if url_name == 'recipe_list' %}active-menu{% endif %}">
                            <a href="{% url 'products:recipe_list' %}">Recipes</a>
                        </li>
                        <li class="{% if url_name == 'gallery' %}active-menu{% endif %}">
                            <a href="{% url 'gallery' %}">Gallery</a>
                        </li>

                        <li class="divider my-2"></li>

                        <li class="{% if url_name == 'about' %}active-menu{% endif %}">
                            <a href="{% url 'about' %}">About Us</a>
                        </li>
                        <li class="{% if url_name == 'contact' %}active-menu{% endif %}">
                            <a href="{% url 'contact' %}">Contact</a>
                        </li>

                        <!-- User Section in menu list -->
                        <li class="user-section mt-4 pt-3 border-top">
                            {% if user.is_authenticated %}
                            <div class="d-grid gap-2">
                                <a href="{% url 'profile' %}" class="btn btn-outline-primary btn-sm">
                                    <i class="fa fa-user me-2"></i>My Account
                                </a>
                                {% if user.is_staff %}
                                <a href="{% url 'products:admin_dashboard' %}" class="btn btn-outline-info btn-sm">
                                    <i class="fa fa-cog me-2"></i>Admin Dashboard
                                </a>
                                {% endif %}
                                <a href="{% url 'logout' %}" class="btn btn-outline-danger btn-sm">
                                    <i class="fa fa-sign-out me-2"></i>Logout
                                </a>
                            </div>
                            {% else %}
                            <div class="d-grid gap-2">
                                <a href="{% url 'login' %}" class="btn btn-primary">
                                    <i class="fa fa-sign-in me-2"></i>Login
                                </a>
                                <a href="{% url 'email_register' %}" class="btn btn-outline-primary">
                                    <i class="fa fa-user-plus me-2"></i>Register
                                </a>
                            </div>
                            {% endif %}
                        </li>
                        {% endwith %}
                    </ul>
                </nav>
            </div>

            <!-- Contact & Social -->
            <div class="offcanvas-widget-area mt-4 p-3 border-top">
                <div class="contact-info mb-3">
                    <p><i class="fa fa-map-marker me-2"></i> Nairobi, Kenya</p>
                    <p><i class="fa fa-phone me-2"></i> <a href="tel:+254700000000">+254 700 000 000</a></p>
                    <p><i class="fa fa-envelope me-2"></i> <a href="mailto:info@arifarm.co.ke">info@arifarm.co.ke</a></p>
                </div>
                <div class="social-icons d-flex gap-3">
                    <a href="#"><i class="fa fa-facebook-f"></i></a>
                    <a href="#"><i class="fa fa-twitter"></i></a>
                    <a href="#"><i class="fa fa-instagram"></i></a>
                    <a href="#"><i class="fa fa-whatsapp"></i></a>
                </div>
            </div>
        </div>
    </div>
</aside>