{% extends 'base.html' %}
{% load static %}

{% block title %}Set New Password - Oreg Organic Shop{% endblock %}

{% block content %}
    <div class="breadcrumbs-area position-relative">
        <div class="container">
            <div class="row">
                <div class="col-12 text-center">
                    <div class="breadcrumb-content position-relative section-content">
                        <h3 class="title-3">Set New Password</h3>
                        <ul>
                            <li><a href="{% url 'home' %}">Home</a></li>
                            <li>Reset Password</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="login-register-area mt-no-text mb-no-text">
        <div class="container container-default-2 custom-area">
            <div class="row">
                <div class="col-lg-6 offset-lg-3 col-md-8 offset-md-2 col-custom">
                    <div class="login-register-wrapper">
                        
                        <div class="text-center mb-4">
                            <a href="{% url 'home' %}">
                                <img src="{% static 'assets/images/logo/logo.png' %}" alt="AriFarm Logo" style="height: 60px;">
                            </a>
                        </div>

                        <div class="section-content text-center mb-5">
                            <div class="mb-4">
                                <i class="icofont-lock" style="font-size: 60px; color: #5a9d3e;"></i>
                            </div>
                            <h2 class="title-4 mb-2">Create New Password</h2>
                            <p class="desc-content">Your new password must be different from previous used passwords.</p>
                        </div>

                        {% if validlink %}
                            <form method="post">
                                {% csrf_token %}

                                {% if form.non_field_errors %}
                                    <div class="alert mb-4" style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 8px;">
                                        {{ form.non_field_errors }}
                                    </div>
                                {% endif %}

                                <div class="single-input-item mb-3">
                                    <input type="password" 
                                           name="new_password1" 
                                           placeholder="New Password" 
                                           required 
                                           autocomplete="new-password">
                                    {% if form.new_password1.errors %}
                                        <small class="text-danger pl-2">{{ form.new_password1.errors|join:", " }}</small>
                                    {% endif %}
                                </div>

                                <div class="single-input-item mb-3">
                                    <input type="password" 
                                           name="new_password2" 
                                           placeholder="Confirm New Password" 
                                           required 
                                           autocomplete="new-password">
                                    {% if form.new_password2.errors %}
                                        <small class="text-danger pl-2">{{ form.new_password2.errors|join:", " }}</small>
                                    {% endif %}
                                </div>
                                
                                <div class="single-input-item mb-3">
                                    <button type="submit" class="btn obrien-button-2 primary-color w-100">
                                        <i class="icofont-save mr-2"></i> Save Password
                                    </button>
                                </div>
                            </form>

                        {% else %}
                            <div class="single-input-item mb-4">
                                <div class="alert text-center" style="background: #fff5f5; border: 1px solid #fab1a0; border-radius: 8px; padding: 20px;">
                                    <h4 class="mb-3" style="color: #dc3545; font-size: 18px; font-weight: 600;">Link Invalid or Expired</h4>
                                    <p class="mb-3" style="font-size: 14px;">This password reset link is no longer valid.</p>
                                    <a href="{% url 'password_reset' %}" class="btn obrien-button-2 primary-color w-100">
                                        Request New Link
                                    </a>
                                </div>
                            </div>
                        {% endif %}

                        <div class="single-input-item text-center mt-4">
                            <a href="{% url 'login' %}" style="color: #444; font-weight: 500;">
                                <i class="icofont-long-arrow-left mr-1"></i> Back to Login
                            </a>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}